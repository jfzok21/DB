<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>活動報名</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
      text-decoration: none;
    }
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; max-width: 1280px; margin: 40px auto; padding: 0 16px; background: #fccdab;}
    h1 { text-align: center; }
    .info { margin-bottom: 16px; }
    label { display: block; margin-top: 12px; }
    input { width: 100%; padding: 8px; margin-top: 4px; }
    button { margin-top: 16px; padding: 10px; width: 100%; cursor: pointer; }
    .msg { margin-top: 16px; font-weight: 600; }
  </style>
</head>
<body>
  <div style="display: flex; justify-content: center; align-items: center; background: #fbeabb;">
    <div style="background: #fbeabb; padding: 100px 100px; margin-left: -200px; margin-right: 200px;">
      <h2 style="font-size: 42px;">國樂下午茶</h2>
      <p>
        一杯冰滴咖啡，一段美妙琴聲，剛好治癒整個秋天。<br>
        藏著不將就的生活態度，極簡風空間搭配民族風音樂。<br>
        慢品咖啡的同時，感受時光沉澱的美好。<br><br>

        <p><i class="fa-solid fa-clock"></i> 星期日 下午3:00 -- 下午4:00</p>
        <a href="https://maps.app.goo.gl/RuNQWcu76TUauRvY9" target="_blank" style="color: black;"><i class="fa-solid fa-location-dot"></i> 沐寒軒庭園咖啡 | 屏東市信義路139號</a>
        <!-- <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3681.472978805655!2d120.4835473749796!3d22.673430179419977!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x346e172a7c16277f%3A0x1b871a225baec2dc!2z5rKQ5ra16LuS6I6K5ZyS5ZKW5ZWh5buz!5e0!3m2!1szh-TW!2stw!4v1763958508045!5m2!1szh-TW!2stw" width="400" height="400" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe> -->
      </p>
    </div>

    <div style="max-width: 480px;">
      <h2>活動報名</h2>

      <div class="info">
        <div>總名額：<span id="total">--</span></div>
        <div>已報名：<span id="used">--</span></div>
        <div>剩餘名額：<span id="left">--</span></div>
      </div>

      <form id="regForm">
        <label>
          姓名
          <input type="text" name="name" required>
        </label>
        <label>
          Email
          <input type="email" name="email" required>
        </label>
        <label>
          電話
          <input type="text" name="phone">
        </label>
        <button type="submit">送出報名</button>
      </form>

      <div class="msg" id="msg"></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/js/all.min.js"></script>
  <script>
    const totalSpan = document.getElementById('total');
    const usedSpan = document.getElementById('used');
    const leftSpan = document.getElementById('left');
    const msg = document.getElementById('msg');
    const form = document.getElementById('regForm');

    async function fetchStatus() {
      try {
        const res = await fetch('/api/status');
        const data = await res.json();
        totalSpan.textContent = data.total;
        usedSpan.textContent = data.used;
        leftSpan.textContent = data.left;
      } catch (e) {
        msg.textContent = '目前無法取得名額資訊，請稍後再試。';
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = '送出中...';

      const formData = new FormData(form);
      const body = {
        name: formData.get('name'),
        email: formData.get('email'),
        phone: formData.get('phone')  // 新增
      };

      try {
        const res = await fetch('/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });

        const data = await res.json();

        if (!res.ok) {
          msg.textContent = data.error || '報名失敗，請稍後再試。';
          return;
        }

        msg.textContent = data.message;
        // 更新最新人數
        totalSpan.textContent = data.total;
        usedSpan.textContent = data.used;
        leftSpan.textContent = data.left;

        if (data.success) {
          form.reset();
        }
      } catch (e) {
        msg.textContent = '系統錯誤，請稍後再試。';
      }
    });

    // 一進來先抓狀態
    fetchStatus();
  </script>
</body>
</html>